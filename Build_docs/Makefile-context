
SPHINXOPTS    ?=
SPHINXBUILD   ?= sphinx-build
SOURCEDIR     = .
BUILDDIR      = ../../SPPDs-Bib-Docs
DESTPATH      = $(BUILDDIR)/html
GH_PAGEDIR    = ../../SPDEs-Bib-Docs

# Put it first so that "make" without argument is like "make help".
help:
	@$(SPHINXBUILD) -M help "$(SOURCEDIR)" "$(BUILDDIR)" $(SPHINXOPTS) $(O)

.PHONY: help deploy html-and-deploy

# Add new deploy target
deploy:
	rsync -av --delete --exclude='.*' "$(DESTPATH)/" "$(GH_PAGEDIR)/" || { echo "rsync failed"; exit 1; }
	cd "$(GH_PAGEDIR)" && git add . && git commit -m "Update documentation on $$(date +'%Y-%m-%d %H:%M:%S')" || { echo "git commit failed"; exit 1; }

# New target that combines html and deploy
html-and-deploy: html deploy

# Catch-all target: route all unknown targets to Sphinx using the new
# "make mode" option.  $(O) is meant as a shortcut for $(SPHINXOPTS).
%: Makefile
	@$(SPHINXBUILD) -M $@ "$(SOURCEDIR)" "$(BUILDDIR)" $(SPHINXOPTS) $(O) -w warnings.log
